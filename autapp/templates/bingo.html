<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chiwe - Bingo</title>
    <style>
        :root {
            --primary: #2ed573;
            --primary-dark: #25a85c;
            --primary-light: #7bed9f;
            --primary-glow: rgba(46, 213, 115, 0.4);
            --background: #0f0f13;
            --surface: #1a1a22;
            --surface-dark: #14141a;
            --text: #ffffff;
            --text-secondary: #a0aec0;
            --danger: #ff4757;
            --warning: #ffa502;
            --success: #2ed573;
            --border-radius: 12px;
            --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            --glow: 0 0 15px var(--primary-glow);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--background);
            color: var(--text);
            min-height: 100vh;
            line-height: 1.6;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 25% 25%, rgba(46, 213, 115, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(46, 213, 115, 0.05) 0%, transparent 50%);
        }

        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 0;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo-icon {
            font-size: 1.8rem;
        }

        .game-title {
            text-align: center;
            margin: 1rem 0 2rem;
            position: relative;
            padding-bottom: 0.75rem;
            color: var(--text);
            font-size: 1.75rem;
            font-weight: 700;
        }

        .game-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 3px;
            background: var(--primary);
            border-radius: 3px;
        }

        .card {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .card-title {
            font-size: 1.25rem;
            color: var(--primary);
            font-weight: 600;
        }

        /* Timer Styles */
        .timer-container {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: var(--surface);
            border-radius: 50%;
            width: 120px;
            height: 120px;
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            border: 3px solid var(--primary);
            box-shadow: 0 0 30px rgba(46, 213, 115, 0.5);
            animation: timerPulse 2s infinite;
        }

        .timer-container.active {
            display: flex;
        }

        .timer-container.warning {
            border-color: var(--warning);
            box-shadow: 0 0 30px rgba(255, 165, 2, 0.5);
            animation: timerWarning 1s infinite;
        }

        .timer-container.danger {
            border-color: var(--danger);
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.5);
            animation: timerDanger 0.5s infinite;
        }

        @keyframes timerPulse {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.05); }
        }

        @keyframes timerWarning {
            0%, 100% { transform: translateY(-50%) scale(1); }
            50% { transform: translateY(-50%) scale(1.1); }
        }

        @keyframes timerDanger {
            0%, 100% { transform: translateY(-50%) scale(1); }
            25% { transform: translateY(-50%) scale(1.15); }
            75% { transform: translateY(-50%) scale(1.05); }
        }

        .timer-content {
            text-align: center;
            position: relative;
        }

        .timer-display {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 0.25rem;
            text-shadow: 0 0 10px rgba(46, 213, 115, 0.5);
        }

        .timer-container.warning .timer-display {
            color: var(--warning);
            text-shadow: 0 0 10px rgba(255, 165, 2, 0.5);
        }

        .timer-container.danger .timer-display {
            color: var(--danger);
            text-shadow: 0 0 10px rgba(255, 71, 87, 0.5);
        }

        .timer-label {
            font-size: 0.7rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .timer-progress {
            position: absolute;
            top: -3px;
            left: -3px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(var(--primary) 0deg, transparent 0deg);
            transition: background 0.1s ease;
        }

        .timer-container.warning .timer-progress {
            background: conic-gradient(var(--warning) 0deg, transparent 0deg);
        }

        .timer-container.danger .timer-progress {
            background: conic-gradient(var(--danger) 0deg, transparent 0deg);
        }

        .timer-progress::before {
            content: '';
            position: absolute;
            top: 6px;
            left: 6px;
            width: 108px;
            height: 108px;
            background: var(--surface);
            border-radius: 50%;
        }

        /* Mobile timer positioning */
        @media (max-width: 768px) {
            .timer-container {
                position: fixed;
                top: 80px;
                right: 10px;
                width: 80px;
                height: 80px;
            }

            .timer-display {
                font-size: 1.4rem;
            }

            .timer-label {
                font-size: 0.6rem;
            }

            .timer-progress {
                width: 80px;
                height: 80px;
            }

            .timer-progress::before {
                top: 4px;
                left: 4px;
                width: 72px;
                height: 72px;
            }
        }

        /* Money selector */
        .money-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
            gap: 0.75rem;
            margin: 1.5rem 0;
        }

        .money-option {
            background: var(--surface-dark);
            border: 2px solid rgba(46, 213, 115, 0.3);
            color: var(--text);
            padding: 0.75rem 0.5rem;
            border-radius: var(--border-radius);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            position: relative;
            overflow: hidden;
        }

        .money-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--glow);
        }

        .money-option:active {
            transform: translateY(1px);
        }

        .money-option.selected {
            background: rgba(46, 213, 115, 0.15);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: var(--glow);
        }

        .money-option.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .submit-btn {
            background: var(--primary);
            color: var(--background);
            border: none;
            padding: 0.75rem 2rem;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            margin-top: 1rem;
        }

        .submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
        }

        .submit-btn:active:not(:disabled) {
            transform: translateY(1px);
        }

        .submit-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }

        /* Network indicator */
        .network-indicator {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(15, 15, 19, 0.8);
            border-radius: 20px;
            padding: 0.5rem 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            z-index: 100;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.8rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .network-bars {
            display: flex;
            align-items: flex-end;
            height: 12px;
            gap: 2px;
        }

        .network-bar {
            width: 3px;
            border-radius: 1px;
            background: rgba(255, 255, 255, 0.2);
        }

        .network-bar.active {
            background: var(--primary);
        }

        .network-bar:nth-child(1) { height: 3px; }
        .network-bar:nth-child(2) { height: 6px; }
        .network-bar:nth-child(3) { height: 9px; }
        .network-bar:nth-child(4) { height: 12px; }

        .network-status {
            color: var(--text-secondary);
        }

        .network-excellent { color: var(--primary); }
        .network-good { color: var(--primary); }
        .network-fair { color: var(--warning); }
        .network-poor { color: var(--danger); }

        /* Enhanced Waiting page */
        .waiting-page {
            text-align: center;
            padding: 2rem 1rem;
        }

        .waiting-message {
            font-size: 1.2rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-weight: 600;
            text-shadow: 0 0 10px rgba(46, 213, 115, 0.3);
            animation: pulsateText 2s infinite;
        }

        @keyframes pulsateText {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .searching-animation {
            display: flex;
            justify-content: center;
            margin: 2rem 0;
        }

        .dot {
            width: 12px;
            height: 12px;
            margin: 0 5px;
            background-color: var(--primary);
            border-radius: 50%;
            animation: dotPulse 1.5s infinite ease-in-out;
        }

        .dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes dotPulse {
            0%, 100% { transform: scale(0.7); opacity: 0.5; }
            50% { transform: scale(1.2); opacity: 1; }
        }

        /* Radar animation */
        .radar-container {
            position: relative;
            width: 200px;
            height: 200px;
            margin: 0 auto 2rem;
        }

        .radar-circle {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid rgba(46, 213, 115, 0.3);
        }

        .radar-circle:nth-child(1) {
            animation: radarPulse 2s infinite;
        }

        .radar-circle:nth-child(2) {
            animation: radarPulse 2s infinite 0.5s;
        }

        .radar-circle:nth-child(3) {
            animation: radarPulse 2s infinite 1s;
        }

        @keyframes radarPulse {
            0% {
                transform: scale(0.1);
                opacity: 1;
            }
            100% {
                transform: scale(1);
                opacity: 0;
            }
        }

        .radar-sweep {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100px;
            height: 100px;
            margin-top: -100px;
            margin-left: 0;
            background: linear-gradient(90deg, rgba(46, 213, 115, 0.5), transparent);
            clip-path: polygon(0 100%, 100% 100%, 100% 0);
            transform-origin: bottom left;
            animation: sweep 3s infinite linear;
        }

        @keyframes sweep {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .radar-dot {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            border-radius: 50%;
            box-shadow: 0 0 10px var(--primary);
            opacity: 0;
        }

        .radar-dot:nth-child(4) {
            top: 30%;
            left: 70%;
            animation: blip 5s infinite 1s;
        }

        .radar-dot:nth-child(5) {
            top: 60%;
            left: 40%;
            animation: blip 5s infinite 2.5s;
        }

        .radar-dot:nth-child(6) {
            top: 20%;
            left: 30%;
            animation: blip 5s infinite 4s;
        }

        @keyframes blip {
            0%, 100% { opacity: 0; transform: scale(0.8); }
            5%, 10% { opacity: 1; transform: scale(1.2); }
            15% { opacity: 0; transform: scale(0.8); }
        }

        .waiting-stats {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 1rem;
            min-width: 150px;
            flex: 1;
            max-width: 200px;
            border: 1px solid rgba(46, 213, 115, 0.2);
            box-shadow: var(--card-shadow);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .game-tips {
            background: rgba(46, 213, 115, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 2rem auto;
            max-width: 600px;
            border: 1px solid rgba(46, 213, 115, 0.2);
        }

        .tips-title {
            color: var(--primary);
            font-size: 1.1rem;
            margin-bottom: 1rem;
            text-align: center;
            font-weight: 600;
        }

        .tip-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 0.75rem;
        }

        .tip-icon {
            color: var(--primary);
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .tip-text {
            font-size: 0.9rem;
            color: var(--text);
            line-height: 1.5;
        }

        .cancel-search-btn {
            background: transparent;
            color: var(--text);
            border: 2px solid rgba(255, 255, 255, 0.2);
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1.5rem;
        }

        .cancel-search-btn:hover {
            border-color: var(--text);
            transform: translateY(-2px);
        }

        /* Loading spinner */
        .loading-spinner {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(46, 213, 115, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            border-radius: var(--border-radius);
            z-index: 10;
        }

        .loading-spinner.active {
            opacity: 1;
            pointer-events: auto;
        }

        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            border-top-color: var(--background);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Popups */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .popup {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 2rem;
            width: 100%;
            max-width: 400px;
            text-align: center;
            position: relative;
            border: 2px solid var(--primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 20px rgba(46, 213, 115, 0.3);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .popup-overlay.active .popup {
            transform: scale(1);
        }

        .popup-title {
            font-size: 1.75rem;
            color: var(--primary);
            margin-bottom: 1rem;
            font-weight: 700;
        }

        .popup-content {
            margin-bottom: 1.5rem;
        }

        .popup-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .popup-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            font-size: 1rem;
        }

        .popup-btn-primary {
            background: var(--primary);
            color: var(--background);
            border: none;
        }

        .popup-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
        }

        .popup-btn-secondary {
            background: transparent;
            color: var(--text);
            border: 2px solid var(--text-secondary);
        }

        .popup-btn-secondary:hover {
            border-color: var(--text);
            transform: translateY(-2px);
        }

        .popup-btn-danger {
            background: transparent;
            color: var(--danger);
            border: 2px solid var(--danger);
        }

        .popup-btn-danger:hover {
            background: var(--danger);
            color: var(--text);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 71, 87, 0.3);
        }

        /* Message display */
        #messageDisplay {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(46, 213, 115, 0.9);
            color: #000;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: bold;
            display: none;
            z-index: 1000;
            max-width: 90%;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* Selected amount highlight */
        .selected-amount {
            background: rgba(46, 213, 115, 0.1);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(46, 213, 115, 0.2);
            transition: all 0.3s ease;
        }

        .selected-amount.highlight {
            background: rgba(46, 213, 115, 0.2);
            box-shadow: 0 0 15px rgba(46, 213, 115, 0.3);
            transform: scale(1.02);
        }

        /* Bingo Board Assembly */
        .board-assembly {
            display: none;
            padding: 1rem 0;
        }

        .board-assembly-title {
            text-align: center;
            color: var(--primary);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .board-assembly-subtitle {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1rem;
        }

        .board-container {
            display: flex;
            flex-direction: column;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        @media (min-width: 768px) {
            .board-container {
                flex-direction: row;
                align-items: flex-start;
            }
        }

        .bingo-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 0.5rem;
            margin: 0 auto;
            max-width: 100%;
            aspect-ratio: 1/1;
        }

        .bingo-cell {
            background: var(--surface-dark);
            border: 2px dashed rgba(46, 213, 115, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            transition: all 0.2s ease;
            position: relative;
            min-height: 2.5rem;
        }

        .bingo-cell.filled {
            border-style: solid;
            border-color: var(--primary);
            background: rgba(46, 213, 115, 0.1);
        }

        .bingo-cell.filled:hover {
            background: rgba(46, 213, 115, 0.2);
            cursor: pointer;
        }

        .bingo-cell.highlight {
            animation: cellHighlight 0.5s ease;
        }

        @keyframes cellHighlight {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); background: rgba(46, 213, 115, 0.3); }
        }

        .number-pool {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.5rem;
            margin: 0 auto;
            max-width: 100%;
        }

        .number-item {
            background: var(--surface);
            border: 2px solid rgba(46, 213, 115, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text);
            transition: all 0.2s ease;
            padding: 0.5rem;
            cursor: pointer;
            user-select: none;
            min-height: 2.5rem;
        }

        .number-item:hover {
            background: rgba(46, 213, 115, 0.1);
            transform: translateY(-2px);
        }

        .number-item:active {
            transform: translateY(1px);
        }

        .number-item.used {
            opacity: 0.3;
            cursor: not-allowed;
            transform: none;
            background: var(--surface-dark);
        }

        .board-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }

        @media (min-width: 768px) {
            .board-actions {
                flex-direction: row;
                justify-content: center;
            }
        }

        .board-action-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .board-action-primary {
            background: var(--primary);
            color: var(--background);
            border: none;
        }

        .board-action-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
        }

        .board-action-primary:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }

        .board-action-secondary {
            background: transparent;
            color: var(--text);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .board-action-secondary:hover {
            border-color: var(--text);
            transform: translateY(-2px);
        }

        .board-action-danger {
            background: transparent;
            color: var(--danger);
            border: 2px solid var(--danger);
        }

        .board-action-danger:hover {
            background: rgba(255, 71, 87, 0.1);
            transform: translateY(-2px);
        }

        .board-instructions {
            background: rgba(46, 213, 115, 0.05);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(46, 213, 115, 0.2);
        }

        .instruction-title {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .instruction-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 0.5rem;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: var(--surface-dark);
            border-radius: 4px;
            margin: 1.5rem 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--primary);
            width: 0;
            transition: width 0.3s ease;
        }

        .board-completion {
            display: flex;
            justify-content: space-between;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Player Matching Screen */
        .player-matching {
            display: none;
            text-align: center;
            padding: 2rem 1rem;
        }

        .vs-container {
            position: relative;
            margin: 3rem auto;
            max-width: 600px;
        }

        .player-card {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--card-shadow);
            border: 2px solid var(--primary);
            transition: all 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .player-card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: conic-gradient(transparent, var(--primary), transparent 30%);
            animation: rotate 4s linear infinite;
        }

        .player-card::after {
            content: '';
            position: absolute;
            inset: 3px;
            background: var(--surface);
            border-radius: calc(var(--border-radius) - 3px);
            z-index: 1;
        }

        @keyframes rotate {
            100% { transform: rotate(1turn); }
        }

        .player-info {
            position: relative;
            z-index: 2;
        }

        .player-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .player-amount {
            font-size: 1rem;
            color: var(--text-secondary);
        }

        .vs-badge {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--primary);
            color: var(--background);
            font-weight: 700;
            font-size: 1.5rem;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            z-index: 10;
            box-shadow: 0 0 20px rgba(46, 213, 115, 0.5);
            animation: pulsate 2s infinite;
        }

        @keyframes pulsate {
            0%, 100% { transform: translate(-50%, -50%) scale(1); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
        }

        .countdown {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin: 2rem 0;
            animation: countdownPulse 1s infinite;
        }

        @keyframes countdownPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .match-message {
            font-size: 1.2rem;
            color: var(--text);
        }
        

        .match-message {
            font-size: 1.2rem;
            color: var(--text);
            margin-bottom: 1rem;
        }

        /* Game Board */
        .game-board-container {
            display: none;
            padding: 1rem 0;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .player-info-card {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 1rem;
            flex: 1;
            min-width: 200px;
            border: 1px solid rgba(46, 213, 115, 0.2);
        }

        .player-info-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }

        .player-info-detail {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .bingo-letters {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .bingo-letter {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 0.25rem;
            text-shadow: 0 0 10px rgba(46, 213, 115, 0.3);
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 0.5rem;
            margin: 0 auto 2rem;
            max-width: 500px;
        }

        .game-cell {
            background: var(--surface-dark);
            border: 2px solid rgba(46, 213, 115, 0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            transition: all 0.2s ease;
            position: relative;
            min-height: 3.5rem;
            cursor: pointer;
        }

        .game-cell:hover {
            background: rgba(46, 213, 115, 0.1);
            transform: translateY(-2px);
        }

        .game-cell:active {
            transform: translateY(1px);
        }

        .game-cell.marked {
            background: rgba(46, 213, 115, 0.2);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 10px rgba(46, 213, 115, 0.3);
        }

        .game-cell.called {
            background: rgba(255, 165, 2, 0.2);
            border-color: var(--warning);
            color: var(--warning);
            animation: calledPulse 2s infinite;
        }

        .game-cell.selected-to-call {
            background: rgba(46, 213, 115, 0.3);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 15px rgba(46, 213, 115, 0.5);
            transform: scale(1.05);
        }

        @keyframes calledPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 165, 2, 0.5); }
            50% { box-shadow: 0 0 15px rgba(255, 165, 2, 0.8); }
        }

        .game-cell.winning {
            background: rgba(46, 213, 115, 0.3);
            border-color: var(--primary);
            color: var(--primary);
            animation: winningPulse 1s infinite;
        }

        @keyframes winningPulse {
            0%, 100% { box-shadow: 0 0 5px rgba(46, 213, 115, 0.5); }
            50% { box-shadow: 0 0 20px rgba(46, 213, 115, 0.8); }
        }

        .game-actions {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .game-action-btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .call-btn {
            background: var(--primary);
            color: var(--background);
            border: none;
            min-width: 150px;
        }

        .call-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
        }

        .call-btn:disabled {
            background: var(--text-secondary);
            cursor: not-allowed;
        }

        /* Enhanced BINGO button styling */
        .bingo-btn {
            background: var(--warning);
            color: var(--background);
            border: none;
            min-width: 150px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
        }

        .bingo-btn:not(:disabled) {
            animation: bingoButtonPulse 2s infinite;
            box-shadow: 0 0 20px rgba(255, 165, 2, 0.5);
            font-weight: 800;
            letter-spacing: 1px;
        }

        .bingo-btn:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
            animation: none;
            box-shadow: none;
        }

        .bingo-btn:hover:not(:disabled) {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(255, 165, 2, 0.6);
            letter-spacing: 2px;
        }

        .bingo-btn:active:not(:disabled) {
            transform: translateY(1px);
        }

        .bingo-btn:not(:disabled)::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
            transform: rotate(0deg);
            animation: bingoButtonGlow 3s linear infinite;
        }

        @keyframes bingoButtonPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes bingoButtonGlow {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .called-numbers {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin: 1.5rem 0;
            border: 1px solid rgba(46, 213, 115, 0.2);
        }

        .called-numbers-title {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 0.5rem;
            text-align: center;
        }

        .called-numbers-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            justify-content: center;
        }

        .called-number {
            background: var(--surface-dark);
            border: 1px solid rgba(46, 213, 115, 0.3);
            border-radius: 4px;
            padding: 0.25rem 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .called-number.latest {
            background: rgba(46, 213, 115, 0.2);
            border-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
            animation: latestNumberPulse 2s infinite;
        }

        @keyframes latestNumberPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Game Over Popup */
        #gameOverPopup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .game-over-content {
            background: linear-gradient(135deg, rgba(23, 25, 35, 0.95), rgba(32, 35, 48, 0.95));
            border-radius: 20px;
            padding: 2.5rem;
            width: 90%;
            max-width: 500px;
            text-align: center;
            position: relative;
            overflow: hidden;
            animation: popIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }

        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .game-over-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), transparent);
            animation: scanline 2s linear infinite;
        }

        @keyframes scanline {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .game-over-header {
            margin-bottom: 2rem;
        }

        .game-over-title {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .winner-title {
            color: var(--primary);
            text-shadow: 0 0 15px rgba(46, 213, 115, 0.5);
        }

        .loser-title {
            color: var(--danger);
            text-shadow: 0 0 15px rgba(255, 71, 87, 0.5);
        }

        .game-over-subtitle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .result-details {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .result-row:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .result-label {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .result-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
        }

        .winning-amount {
            color: var(--primary);
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(46, 213, 115, 0.5);
        }

        .game-over-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .game-over-btn {
            padding: 1rem 2rem;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1.1rem;
            min-width: 180px;
        }

        .play-again-btn {
            background: var(--primary);
            color: var(--background);
            border: none;
        }

        .play-again-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(46, 213, 115, 0.3);
        }

        .dashboard-btn {
            background: transparent;
            color: var(--text);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }

        .dashboard-btn:hover {
            border-color: var(--text);
            transform: translateY(-3px);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--primary);
            opacity: 0.8;
            animation: confettiFall linear forwards;
        }

        @keyframes confettiFall {
            0% { transform: translateY(-100vh) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(720deg); }
        }

        /* Media queries for responsive design */
        @media (min-width: 768px) {
            .game-title {
                font-size: 2.25rem;
                margin: 1.5rem 0 2.5rem;
            }

            .money-selector {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .waiting-stats {
                flex-wrap: nowrap;
            }

            .bingo-cell {
                font-size: 1.5rem;
                min-height: 3.5rem;
            }

            .number-item {
                font-size: 1.5rem;
                min-height: 3rem;
            }

            .game-cell {
                font-size: 1.75rem;
                min-height: 4rem;
            }

            .bingo-letter {
                font-size: 2.5rem;
                width: 60px;
                height: 60px;
            }
        }

        @media (max-width: 480px) {
            .money-selector {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .network-indicator {
                top: 10px;
                left: 10px;
                padding: 0.4rem 0.6rem;
                font-size: 0.7rem;
            }
            
            .radar-container {
                width: 150px;
                height: 150px;
            }

            .bingo-cell {
                font-size: 1rem;
                min-height: 2.2rem;
            }

            .number-item {
                font-size: 1rem;
                min-height: 2.2rem;
                padding: 0.4rem;
            }

            .board-assembly-title {
                font-size: 1.25rem;
            }

            .game-cell {
                font-size: 1.25rem;
                min-height: 2.5rem;
            }

            .bingo-letter {
                font-size: 1.5rem;
                width: 40px;
                height: 40px;
            }

            .game-over-content {
                padding: 1.5rem;
            }

            .game-over-title {
                font-size: 2rem;
            }

            .game-over-btn {
                padding: 0.8rem 1.5rem;
                font-size: 1rem;
                min-width: 150px;
            }
        }

        /* Drag and drop styles */
        .dragging {
            opacity: 0.5;
            transform: scale(1.1);
            z-index: 100;
        }

        .drag-over {
            background: rgba(46, 213, 115, 0.2);
            border-color: var(--primary);
        }

        /* Shake animation for invalid actions */
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--surface);
            color: var(--text);
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(46, 213, 115, 0.2);
            font-size: 0.8rem;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
    </style>
</head>
<body>
    <!-- Network Indicator -->
    <div class="network-indicator">
        <div class="network-bars">
            <div class="network-bar active"></div>
            <div class="network-bar active"></div>
            <div class="network-bar active"></div>
            <div class="network-bar"></div>
        </div>
        <span class="network-status network-good" id="network-text">Good</span>
    </div>

    <!-- Timer Container -->
    <div class="timer-container" id="timerContainer">
        <div class="timer-progress" id="timerProgress"></div>
        <div class="timer-content">
            <div class="timer-display" id="timerDisplay">45</div>
            <div class="timer-label">SECONDS</div>
        </div>
    </div>

    <!-- Message Display -->
    <div id="messageDisplay"></div>

    <div class="container">
        <h1 class="game-title">Bingo</h1>

        <!-- Game Setup -->
        <div id="gameSetup" class="card">
            <div class="card-header">
                <h2 class="card-title">Select Bet Amount</h2>
            </div>
            
            <div class="money-selector">
                <div class="money-option" data-amount="25" onclick="selectAmount(25)">
                    25 birr
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="money-option" data-amount="50" onclick="selectAmount(50)">
                    50 birr
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
                <div class="money-option" data-amount="100" onclick="selectAmount(100)">
                    100 birr
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 1.5rem;">
                <form id="joinForm" class="join-form" method="post">
                    {% csrf_token %}
                    <input type="hidden" id="amountInput" name="amount" value="">
                    <div class="selected-amount" id="selectedAmountContainer">
                        <p class="info-label">Selected Amount:</p>
                        <p class="info-value"><span id="selectedAmount">0</span> birr</p>
                    </div>
                    <button type="submit" id="joinButton" class="submit-btn" disabled>
                        Join Game
                        <div class="loading-spinner">
                            <div class="spinner"></div>
                    </button>
                </form>
            </div>
        </div>

        <!-- Board Assembly -->
        <div id="boardAssembly" class="board-assembly">
            <h2 class="board-assembly-title">Create Your Bingo Board</h2>
            <p class="board-assembly-subtitle">Drag and drop numbers to create your unique board</p>
            
            <div class="board-instructions">
                <div class="instruction-title">
                    <span>ðŸ“‹</span> Instructions
                </div>
                <p class="instruction-text">1. Drag numbers from the pool to your board</p>
                <p class="instruction-text">2. Click on a placed number to remove it</p>
                <p class="instruction-text">3. Fill all 25 spaces to complete your board</p>
                <p class="instruction-text">4. Click "Join Game" when you're ready</p>
                
                <div class="progress-bar-container">
                    <div class="progress-bar" id="boardProgress"></div>
                </div>
                <div class="board-completion">
                    <span>Board completion:</span>
                    <span id="completionText">0/25</span>
                </div>
            </div>
            
            <div class="board-container">
                <div class="bingo-board" id="bingoBoard">
                    <!-- 5x5 grid will be generated by JavaScript -->
                </div>
                
                <div class="number-pool" id="numberPool">
                    <!-- Numbers 1-25 will be generated by JavaScript -->
                </div>
            </div>
            
            <div class="board-actions">
                <button id="randomizeBtn" class="board-action-btn board-action-secondary">
                    <span>ðŸŽ²</span> Randomize
                </button>
                <button id="clearBoardBtn" class="board-action-btn board-action-danger">
                    <span>ðŸ—‘ï¸</span> Clear Board
                </button>
                <button id="joinGameBtn" class="board-action-btn board-action-primary" disabled>
                    <span>ðŸŽ®</span> Join Game
                    <div class="loading-spinner">
                        <div class="spinner"></div>
                    </div>
                </button>
            </div>
        </div>

        <!-- Player Matching Screen -->
        <div id="playerMatching" class="player-matching">
            <h2 class="board-assembly-title">Game Starting</h2>
            <p class="match-message">You've been matched with another player!</p>
            
            <div class="vs-container">
                <div class="player-card">
                    <div class="player-info">
                        <div class="player-name" id="player1Name">Player 1</div>
                        <div class="player-amount" id="player1Amount">50 birr</div>
                    </div>
                </div>
                
                <div class="vs-badge">VS</div>
                
                <div class="player-card">
                    <div class="player-info">
                        <div class="player-name" id="player2Name">Player 2</div>
                        <div class="player-amount" id="player2Amount">50 birr</div>
                    </div>
                </div>
            </div>
            
            <div class="countdown" id="countdown">5</div>
            
            <p class="board-assembly-subtitle">Get ready to play Bingo!</p>
        </div>

        <!-- Game Board -->
        <div id="gameBoard" class="game-board-container">
            <div class="game-info">
                <div class="player-info-card">
                    <div class="player-info-name" id="currentPlayerName">Your Name</div>
                    <div class="player-info-detail">Bet: <span id="currentPlayerAmount">50 birr</span></div>
                </div>
                
                <div class="player-info-card">
                    <div class="player-info-name" id="opponentName">Opponent</div>
                    <div class="player-info-detail">Bet: <span id="opponentAmount">50 birr</span></div>
                </div>
            </div>
            
            <div class="bingo-letters">
                <div class="bingo-letter">B</div>
                <div class="bingo-letter">I</div>
                <div class="bingo-letter">N</div>
                <div class="bingo-letter">G</div>
                <div class="bingo-letter">O</div>
            </div>
            
            <div class="game-board" id="gameBingoBoard">
                <!-- 5x5 grid will be generated by JavaScript -->
            </div>
            
            <div class="called-numbers">
                <div class="called-numbers-title">Called Numbers</div>
                <div class="called-numbers-list" id="calledNumbersList">
                    <!-- Called numbers will be added here -->
                </div>
            </div>
            
            <div class="game-actions">
                <button id="callBtn" class="game-action-btn call-btn">
                    <span>ðŸ“¢</span> Call Number
                </button>
                <button id="bingoBtn" class="game-action-btn bingo-btn" disabled>
                    <span>ðŸŽ‰</span> BINGO!
                </button>
            </div>
        </div>

        <!-- Enhanced Waiting Page -->
        <div id="gameStatus" class="waiting-page" style="display: none;">
            <p class="waiting-message">Searching for Bingo players...</p>
            
            <!-- Radar Animation -->
            <div class="radar-container">
                <div class="radar-circle"></div>
                <div class="radar-circle"></div>
                <div class="radar-circle"></div>
                <div class="radar-sweep"></div>
                <div class="radar-dot"></div>
                <div class="radar-dot"></div>
                <div class="radar-dot"></div>
            </div>
            
            <!-- Game Stats -->
            <div class="waiting-stats">
                <div class="stat-card">
                    <div class="stat-value" id="onlinePlayers">24</div>
                    <div class="stat-label">Players Online</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeGames">8</div>
                    <div class="stat-label">Active Games</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgWaitTime">12s</div>
                    <div class="stat-label">Avg. Wait Time</div>
                </div>
            </div>
            
            <!-- Game Tips -->
            <div class="game-tips">
                <h3 class="tips-title">Bingo Game Tips</h3>
                <div class="tip-item">
                    <div class="tip-icon">ðŸŒ</div>
                    <div class="tip-text">Make sure you have a stable internet connection to avoid disconnections during the game.</div>
                </div>
                <div class="tip-item">
                    <div class="tip-icon">ðŸŽ¯</div>
                    <div class="tip-text">Mark your numbers quickly as they are called to increase your chances of winning.</div>
                </div>
                <div class="tip-item">
                    <div class="tip-icon">ðŸŽ®</div>
                    <div class="tip-text">You can win by completing a horizontal, vertical, or diagonal line on your card.</div>
                </div>
                <div class="tip-item">
                    <div class="tip-icon">ðŸ†</div>
                    <div class="tip-text">Shout "BINGO!" by clicking the button when you complete a winning pattern.</div>
                </div>
            </div>
            
            <button class="cancel-search-btn" onclick="showLeaveWarning()">Cancel Search</button>
        </div>
    </div>

    <!-- Leave Game Warning Popups -->
    <div id="searchLeaveWarning" class="popup-overlay">
        <div class="popup">
            <h2 class="popup-title">Leaving the Search?</h2>
            <div class="popup-content">
                <p>Are you sure you want to stop searching for Bingo players?</p>
            </div>
            <div class="popup-actions">
                <button class="popup-btn popup-btn-danger" onclick="confirmLeaveSearch()">Yes, Leave</button>
                <button class="popup-btn popup-btn-secondary" onclick="cancelLeave()">Stay</button>
            </div>
        </div>
    </div>

    <!-- Game Over Popup -->
    <div id="gameOverPopup">
        <div class="game-over-content">
            <div class="game-over-header">
                <h2 class="game-over-title" id="gameOverTitle">Game Over</h2>
                <p class="game-over-subtitle" id="gameOverSubtitle">The game has ended</p>
            </div>
            
            <div class="result-details">
                <div class="result-row">
                    <div class="result-label">Winner:</div>
                    <div class="result-value" id="winnerName">Player 1</div>
                </div>
                <div class="result-row">
                    <div class="result-label">Bet Amount:</div>
                    <div class="result-value" id="betAmount">50 birr</div>
                </div>
                <div class="result-row">
                    <div class="result-label">Winning Amount:</div>
                    <div class="result-value winning-amount" id="winningAmount">100 birr</div>
                </div>
            </div>
            
            <div class="game-over-actions">
                <button class="game-over-btn play-again-btn" onclick="window.location.reload()">Play Again</button>
                <button class="game-over-btn dashboard-btn" onclick="window.location.href='/dashboard'">Dashboard</button>
            </div>
        </div>
    </div>

    <script>
        let isSearching = false;
        let attemptingToLeave = false;
        let networkStatus = 'Good';
        let networkBars = 3;
        let selectedAmount = 0;
        let boardCells = [];
        let usedNumbers = new Set();
        let currentBetAmount = 0;
        let gameSocket = null;
        let gameBoard = [];
        let calledNumbers = [];
        let selectedNumber = null;
        let myTurn = false;
        let currentPlayer = '';
        let opponent = '';
        let completedLetters = 0; // Track how many BINGO letters are completed
        let username = ''; // Store the user's username

        // Timer variables
        let timerInterval = null;
        let currentTime = 0;
        let totalTime = 0;
        let isTimerActive = false;

        // Timer functions
        function startTimer(time) {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            currentTime = time;
            totalTime = time;
            isTimerActive = true;
            
            const timerContainer = document.getElementById('timerContainer');
            const timerDisplay = document.getElementById('timerDisplay');
            const timerProgress = document.getElementById('timerProgress');
            
            // Show timer
            timerContainer.classList.add('active');
            timerContainer.classList.remove('warning', 'danger');
            
            // Update display
            timerDisplay.textContent = currentTime;
            updateTimerProgress();
            
            // Start countdown
            timerInterval = setInterval(() => {
                currentTime--;
                timerDisplay.textContent = currentTime;
                updateTimerProgress();
                
                // Change timer appearance based on remaining time
                if (currentTime <= 10 && currentTime > 5) {
                    timerContainer.classList.add('warning');
                    timerContainer.classList.remove('danger');
                } else if (currentTime <= 5) {
                    timerContainer.classList.add('danger');
                    timerContainer.classList.remove('warning');
                }
                
                // Timer finished
                if (currentTime <= 0) {
                    stopTimer();
                    displayMessage('Time\'s up! Your turn has ended.');
                }
            }, 1000);
            
            displayMessage(`Your turn! You have ${time} seconds to make a move.`);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            isTimerActive = false;
            const timerContainer = document.getElementById('timerContainer');
            timerContainer.classList.remove('active', 'warning', 'danger');
        }

        function resetTimer() {
            stopTimer();
            currentTime = 0;
            totalTime = 0;
        }

        function updateTimerProgress() {
            const timerProgress = document.getElementById('timerProgress');
            const percentage = ((totalTime - currentTime) / totalTime) * 360;
            timerProgress.style.background = `conic-gradient(var(--primary) ${percentage}deg, transparent ${percentage}deg)`;
            
            // Update progress color based on timer state
            const timerContainer = document.getElementById('timerContainer');
            if (timerContainer.classList.contains('warning')) {
                timerProgress.style.background = `conic-gradient(var(--warning) ${percentage}deg, transparent ${percentage}deg)`;
            } else if (timerContainer.classList.contains('danger')) {
                timerProgress.style.background = `conic-gradient(var(--danger) ${percentage}deg, transparent ${percentage}deg)`;
            }
        }

// Simulate dynamic stats for waiting page
function updateWaitingStats() {
    // Simulate random fluctuations in online players
    const onlinePlayers = Math.floor(Math.random() * 10) + 20;
    document.getElementById('onlinePlayers').textContent = onlinePlayers;
    
    // Simulate active games (roughly 1/3 of online players)
    const activeGames = Math.floor(onlinePlayers / 3);
    document.getElementById('activeGames').textContent = activeGames;
    
    // Simulate wait time based on player count (fewer players = longer wait)
    const avgWaitTime = Math.max(5, Math.floor(30 - onlinePlayers/2));
    document.getElementById('avgWaitTime').textContent = avgWaitTime + 's';
}

// Function to show loading spinner on buttons
function showLoading(element) {
    if (!element) return;
    element.disabled = true;
    const spinner = element.querySelector('.loading-spinner');
    if (spinner) spinner.classList.add('active');
}

// Function to hide loading spinner on buttons
function hideLoading(element) {
    if (!element) return;
    element.disabled = false;
    const spinner = element.querySelector('.loading-spinner');
    if (spinner) spinner.classList.remove('active');
}

// Function to update network indicator
function updateNetworkIndicator(status) {
    const networkText = document.getElementById('network-text');
    const bars = document.querySelectorAll('.network-bar');
    
    switch(status) {
        case 'Excellent':
            networkBars = 4;
            networkText.textContent = 'Excellent';
            networkText.className = 'network-status network-excellent';
            break;
        case 'Good':
            networkBars = 3;
            networkText.textContent = 'Good';
            networkText.className = 'network-status network-good';
            break;
        case 'Fair':
            networkBars = 2;
            networkText.textContent = 'Fair';
            networkText.className = 'network-status network-fair';
            break;
        case 'Poor':
            networkBars = 1;
            networkText.textContent = 'Poor';
            networkText.className = 'network-status network-poor';
            break;
        default:
            networkBars = 0;
            networkText.textContent = 'Offline';
            networkText.className = 'network-status network-poor';
    }
    
    bars.forEach((bar, index) => {
        if (index < networkBars) {
            bar.classList.add('active');
        } else {
            bar.classList.remove('active');
        }
    });
}

// Monitor network status
function monitorNetwork() {
    // Initial network check
    checkNetworkStatus();
    
    // Check connection speed periodically
    setInterval(checkNetworkStatus, 5000);
    
    // Also update based on navigator.onLine
    window.addEventListener('online', () => {
        if (networkBars === 0) updateNetworkIndicator('Fair');
    });
    
    window.addEventListener('offline', () => {
        updateNetworkIndicator('Offline');
    });
}

// Function to check network status
function checkNetworkStatus() {
    const start = Date.now();
    
    
}

function displayMessage(message) {
    const messageDisplay = document.getElementById('messageDisplay');
    messageDisplay.textContent = message;
    messageDisplay.style.display = 'block';
    setTimeout(() => {
        messageDisplay.style.display = 'none';
    }, 4000);
}

// Initialize the bingo board
function initBingoBoard() {
    const bingoBoard = document.getElementById('bingoBoard');
    bingoBoard.innerHTML = '';
    boardCells = [];
    
    // Create 5x5 grid
    for (let i = 0; i < 25; i++) {
        const cell = document.createElement('div');
        cell.className = 'bingo-cell';
        cell.dataset.index = i;
        
        // Add event listeners for drag and drop
        cell.addEventListener('dragover', (e) => {
            e.preventDefault();
            if (!cell.classList.contains('filled')) {
                cell.classList.add('drag-over');
            }
        });
        
        cell.addEventListener('dragleave', () => {
            cell.classList.remove('drag-over');
        });
        
        cell.addEventListener('drop', (e) => {
            e.preventDefault();
            cell.classList.remove('drag-over');
            
            const number = e.dataTransfer.getData('text/plain');
            if (!cell.classList.contains('filled')) {
                placeNumber(cell, number);
            } else {
                // Shake effect for invalid drop
                cell.classList.add('shake');
                setTimeout(() => cell.classList.remove('shake'), 500);
            }
        });
        
        // Click to remove number
        cell.addEventListener('click', () => {
            if (cell.classList.contains('filled')) {
                const number = parseInt(cell.textContent);
                cell.textContent = '';
                cell.classList.remove('filled');
                usedNumbers.delete(number);
                
                // Update number pool
                const numberItem = document.querySelector(`.number-item[data-number="${number}"]`);
                if (numberItem) {
                    numberItem.classList.remove('used');
                    numberItem.draggable = true;
                }
                
                updateBoardProgress();
            }
        });
        
        bingoBoard.appendChild(cell);
        boardCells.push(cell);
    }
}

// Initialize the number pool
function initNumberPool() {
    const numberPool = document.getElementById('numberPool');
    numberPool.innerHTML = '';
    usedNumbers.clear();
    
    // Create numbers 1-25
    for (let i = 1; i <= 25; i++) {
        const numberItem = document.createElement('div');
        numberItem.className = 'number-item';
        numberItem.textContent = i;
        numberItem.dataset.number = i;
        numberItem.draggable = true;
        
        // Add drag event listeners
        numberItem.addEventListener('dragstart', (e) => {
            if (numberItem.classList.contains('used')) {
                e.preventDefault();
                return;
            }
            
            e.dataTransfer.setData('text/plain', i.toString());
            numberItem.classList.add('dragging');
            
            // For mobile: hide the drag image
            const img = new Image();
            img.src = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
            e.dataTransfer.setDragImage(img, 0, 0);
        });
        
        numberItem.addEventListener('dragend', () => {
            numberItem.classList.remove('dragging');
        });
        
        // Click to place in first available cell
        numberItem.addEventListener('click', () => {
            if (!numberItem.classList.contains('used')) {
                const availableCell = boardCells.find(cell => !cell.classList.contains('filled'));
                if (availableCell) {
                    placeNumber(availableCell, i.toString());
                } else {
                    // Shake effect if board is full
                    numberItem.classList.add('shake');
                    setTimeout(() => numberItem.classList.remove('shake'), 500);
                }
            }
        });
        
        numberPool.appendChild(numberItem);
    }
}

// Place a number on the board
function placeNumber(cell, number) {
    const num = parseInt(number);
    
    // Mark the number as used
    usedNumbers.add(num);
    
    // Update the cell
    cell.textContent = number;
    cell.classList.add('filled');
    cell.classList.add('highlight');
    setTimeout(() => cell.classList.remove('highlight'), 500);
    
    // Update the number pool
    const numberItem = document.querySelector(`.number-item[data-number="${num}"]`);
    if (numberItem) {
        numberItem.classList.add('used');
        numberItem.draggable = false;
    }
    
    updateBoardProgress();
}

// Update board progress
function updateBoardProgress() {
    const filledCells = document.querySelectorAll('.bingo-cell.filled').length;
    const progressBar = document.getElementById('boardProgress');
    const completionText = document.getElementById('completionText');
    const joinGameBtn = document.getElementById('joinGameBtn');
    
    const progressPercentage = (filledCells / 25) * 100;
    progressBar.style.width = `${progressPercentage}%`;
    completionText.textContent = `${filledCells}/25`;
    
    // Enable/disable join button
    if (filledCells === 25) {
        joinGameBtn.disabled = false;
    } else {
        joinGameBtn.disabled = true;
    }
}

// Randomize the board
function randomizeBoard() {
    // Clear the board first
    clearBoard();
    
    // Generate random numbers 1-25
    const numbers = Array.from({length: 25}, (_, i) => i + 1);
    
    // Shuffle the array
    for (let i = numbers.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [numbers[i], numbers[j]] = [numbers[j], numbers[i]];
    }
    
    // Place numbers on the board
    boardCells.forEach((cell, index) => {
        placeNumber(cell, numbers[index].toString());
    });
}

// Clear the board
function clearBoard() {
    boardCells.forEach(cell => {
        if (cell.classList.contains('filled')) {
            const number = parseInt(cell.textContent);
            cell.textContent = '';
            cell.classList.remove('filled');
            usedNumbers.delete(number);
        }
    });
    
    // Reset number pool
    document.querySelectorAll('.number-item').forEach(item => {
        item.classList.remove('used');
        item.draggable = true;
    });
    
    updateBoardProgress();
}

// Get board numbers as an array
function getBoardNumbers() {
    return boardCells.map(cell => {
        return cell.textContent ? parseInt(cell.textContent) : 0;
    });
}

// Initialize the game board
function initGameBoard(boardNumbers) {
    const gameBingoBoard = document.getElementById('gameBingoBoard');
    gameBingoBoard.innerHTML = '';
    gameBoard = [];
    
    // Create 5x5 grid with the provided numbers
    for (let i = 0; i < 25; i++) {
        const cell = document.createElement('div');
        cell.className = 'game-cell';
        cell.dataset.index = i;
        cell.textContent = boardNumbers[i];
        
        // Add click event to mark/unmark numbers or select for calling
        cell.addEventListener('click', () => {
            // If it's my turn, select this number to call
            if (myTurn && !calledNumbers.includes(parseInt(cell.textContent))) {
                // Clear previous selection
                gameBoard.forEach(c => c.classList.remove('selected-to-call'));
                
                // Select this number
                cell.classList.add('selected-to-call');
                selectedNumber = parseInt(cell.textContent);
                
                // Enable call button
                document.getElementById('callBtn').disabled = false;
                
                displayMessage(`Number ${selectedNumber} selected. Click "Call Number" to announce it.`);
            } else if (calledNumbers.includes(parseInt(cell.textContent))) {
                // Toggle marked state for called numbers
                if (cell.classList.contains('marked')) {
                    cell.classList.remove('marked');
                } else {
                    cell.classList.add('marked');
                    checkForWin();
                }
            } else {
                // Shake effect for invalid selection
                cell.classList.add('shake');
                setTimeout(() => cell.classList.remove('shake'), 500);
                
                if (myTurn) {
                    displayMessage('Select a number that hasn\'t been called yet.');
                } else {
                    displayMessage('Wait for your turn to call a number.');
                }
            }
        });
        
        gameBingoBoard.appendChild(cell);
        gameBoard.push(cell);
    }
    
    // Initialize BINGO letters as inactive
    updateBingoLetters(0);
}

// Update BINGO letters based on completion status
function updateBingoLetters(completed) {
    completedLetters = completed;
    const letters = document.querySelectorAll('.bingo-letter');
    
    // Reset all letters to inactive state
    letters.forEach((letter, index) => {
        if (index < completed) {
            // Active state
            letter.style.opacity = '1';
            letter.style.textShadow = '0 0 15px rgba(46, 213, 115, 0.8)';
            letter.style.transform = 'scale(1.1)';
        } else {
            // Inactive state
            letter.style.opacity = '0.4';
            letter.style.textShadow = 'none';
            letter.style.transform = 'scale(1)';
        }
    });
    
    // Enable BINGO button only when all letters are completed
    const bingoBtn = document.getElementById('bingoBtn');
    bingoBtn.disabled = completed < 5;
    
    if (completed === 5) {
        displayMessage('You can now claim BINGO! Click the BINGO button!');
    }
}

// Update called numbers display
function updateCalledNumbers(number, isLatest = false) {
    const calledNumbersList = document.getElementById('calledNumbersList');
    
    // Remove 'latest' class from all numbers
    document.querySelectorAll('.called-number.latest').forEach(item => {
        item.classList.remove('latest');
    });
    
    // Add the new number
    const numberItem = document.createElement('div');
    numberItem.className = 'called-number';
    if (isLatest) {
        numberItem.classList.add('latest');
    }
    numberItem.textContent = number;
    calledNumbersList.appendChild(numberItem);
    
    // Highlight the number on the board if it exists
    gameBoard.forEach(cell => {
        if (parseInt(cell.textContent) === number) {
            cell.classList.add('called');
            // Auto-mark the number after a short delay
            setTimeout(() => {
                cell.classList.add('marked');
                checkForWin();
            }, 1000);
        }
    });
}

// Check for winning patterns
function checkForWin() {
    const markedCells = gameBoard.filter(cell => cell.classList.contains('marked'));
    
    if (markedCells.length < 5) return false; // Need at least 5 marked cells
    
    let winFound = false;
    
    // Check rows
    for (let row = 0; row < 5; row++) {
        let rowComplete = true;
        for (let col = 0; col < 5; col++) {
            const index = row * 5 + col;
            if (!gameBoard[index].classList.contains('marked')) {
                rowComplete = false;
                break;
            }
        }
        if (rowComplete) {
            highlightWinningCells(row * 5, row * 5 + 1, row * 5 + 2, row * 5 + 3, row * 5 + 4);
            winFound = true;
        }
    }
    
    // Check columns
    for (let col = 0; col < 5; col++) {
        let colComplete = true;
        for (let row = 0; row < 5; row++) {
            const index = row * 5 + col;
            if (!gameBoard[index].classList.contains('marked')) {
                colComplete = false;
                break;
            }
        }
        if (colComplete) {
            highlightWinningCells(col, col + 5, col + 10, col + 15, col + 20);
            winFound = true;
        }
    }
    
    // Check diagonals
    let diag1Complete = true;
    let diag2Complete = true;
    
    for (let i = 0; i < 5; i++) {
        if (!gameBoard[i * 5 + i].classList.contains('marked')) {
            diag1Complete = false;
        }
        if (!gameBoard[i * 5 + (4 - i)].classList.contains('marked')) {
            diag2Complete = false;
        }
    }
    
    if (diag1Complete) {
        highlightWinningCells(0, 6, 12, 18, 24);
        winFound = true;
    }
    
    if (diag2Complete) {
        highlightWinningCells(4, 8, 12, 16, 20);
        winFound = true;
    }
    
    return winFound;
}

// Highlight winning cells
function highlightWinningCells(...indices) {
    indices.forEach(index => {
        gameBoard[index].classList.add('winning');
    });
}

// Create confetti effect for winner
function createConfetti() {
    const container = document.querySelector('.game-over-content');
    const colors = ['#2ed573', '#7bed9f', '#f1c40f', '#e67e22', '#e74c3c', '#9b59b6'];
    
    for (let i = 0; i < 100; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + '%';
        confetti.style.width = Math.random() * 10 + 5 + 'px';
        confetti.style.height = Math.random() * 10 + 5 + 'px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
        confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
        confetti.style.animationDelay = Math.random() * 5 + 's';
        
        container.appendChild(confetti);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    history.pushState(null, null, location.href);

    window.onpopstate = (event) => {
        history.pushState(null, null, location.href);
        handleBackButton();
    };

    window.onbeforeunload = (e) => {
        if (isSearching) {
            e.preventDefault();
            e.returnValue = '';
            showLeaveWarning();
            return '';
        }
    };
    
    // Initialize network monitoring
    monitorNetwork();
    
    // Initialize waiting page stats
    updateWaitingStats();
    setInterval(updateWaitingStats, 5000);
    
    // Disable join button initially
    document.getElementById('joinButton').disabled = true;
    
    // Initialize bingo board and number pool
    initBingoBoard();
    initNumberPool();
    
    // Add event listeners for board actions
    document.getElementById('randomizeBtn').addEventListener('click', randomizeBoard);
    document.getElementById('clearBoardBtn').addEventListener('click', clearBoard);
    document.getElementById('joinGameBtn').addEventListener('click', startBingoGame);
    
    // Add event listeners for game actions
    document.getElementById('callBtn').addEventListener('click', callNumber);
    document.getElementById('bingoBtn').addEventListener('click', claimBingo);
    
    // Disable BINGO button initially
    document.getElementById('bingoBtn').disabled = true;
});

function handleBackButton() {
    if (isSearching) {
        showLeaveWarning();
    }
}

function showLeaveWarning() {
    const warningElement = document.getElementById('searchLeaveWarning');
    warningElement.style.display = 'flex';
}

function cancelLeave() {
    document.getElementById('searchLeaveWarning').style.display = 'none';
}

function confirmLeaveSearch() {
    attemptingToLeave = true;
    
    // Close WebSocket connection if it exists
    if (gameSocket) {
        gameSocket.close();
    }
    
    // Stop timer if active
    resetTimer();
    
    isSearching = false;
    window.location.href = '/dashboard';
}

function selectAmount(amount) {
    selectedAmount = amount;
    
    // Show loading on the selected button
    const buttons = document.querySelectorAll('.money-option');
    buttons.forEach(button => {
        // Clear all selections first
        button.classList.remove('selected');
        hideLoading(button);
        
        // Apply selection and loading to the clicked button
        if (parseInt(button.getAttribute('data-amount')) === amount) {
            button.classList.add('selected');
            showLoading(button);
        }
    });
    
    // Update the selected amount display
    document.getElementById('amountInput').value = amount;
    document.getElementById('selectedAmount').textContent = amount;
    
    // Highlight the selected amount container
    const selectedAmountContainer = document.getElementById('selectedAmountContainer');
    selectedAmountContainer.classList.add('highlight');
    
    // Enable the join button
    document.getElementById('joinButton').disabled = false;
    
    // Hide loading after a short delay to show the selection effect
    setTimeout(() => {
        buttons.forEach(button => {
            if (parseInt(button.getAttribute('data-amount')) === amount) {
                hideLoading(button);
            }
        });
        
        // Remove highlight after animation
        setTimeout(() => {
            selectedAmountContainer.classList.remove('highlight');
        }, 500);
    }, 500);
}

document.getElementById('joinForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (selectedAmount === 0) {
        displayMessage('Please select a bet amount first');
        return;
    }
    
    const form = e.target;
    const formData = new FormData(form);
    
    // Show loading on submit button
    const submitButton = form.querySelector('button');
    showLoading(submitButton);

    try {
        const response = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const contentType = response.headers.get('content-type');
        if (contentType && contentType.indexOf('application/json') !== -1) {
            const data = await response.json();
            console.log(data);
            handleJoinResponse(data);
        } else {
            const text = await response.text();
            console.log('Non-JSON response:', text);
            displayMessage('Unexpected server response. Please try again.');
            hideLoading(submitButton);
        }
    } catch (error) {
        console.error('Error:', error);
        displayMessage('An error occurred. Please try again later.');
        hideLoading(submitButton);
    }
});

function handleJoinResponse(data) {
    const submitButton = document.querySelector('#joinForm button');
    console.log(data)
    
    if (!data.proceed) {
        hideLoading(submitButton);
        displayMessage(data.message || 'Unable to join the game. Please try again.');
        return;
    }
    
    // Store the current bet amount
    currentBetAmount = data.amount;
    
    // Check if we need to show the board assembly
    if (data.type === "Assembly") {
        document.getElementById('gameSetup').style.display = 'none';
        document.getElementById('boardAssembly').style.display = 'block';
        hideLoading(submitButton);
        displayMessage('Create your Bingo board to join the game!');
    } else {
        // Legacy behavior - direct to waiting page
        document.getElementById('gameSetup').style.display = 'none';
        document.getElementById('gameStatus').style.display = 'block';
        isSearching = true;
        // Don't initialize WebSocket here anymore
        hideLoading(submitButton);
    }
}

function startBingoGame() {
    // Get the board numbers
    const boardNumbers = getBoardNumbers();
    
    // Validate the board
    if (boardNumbers.length !== 25 || boardNumbers.some(num => num === 0)) {
        displayMessage('Please fill all cells in your board');
        return;
    }
    
    // Show loading on join button
    const joinButton = document.getElementById('joinGameBtn');
    showLoading(joinButton);
    
    // Check if we already have an active WebSocket connection
    if (gameSocket && (gameSocket.readyState === WebSocket.OPEN || gameSocket.readyState === WebSocket.CONNECTING)) {
        // Close the existing connection if the button is clicked again
        gameSocket.close();
        isSearching = false;
        displayMessage('Game search cancelled');
        document.getElementById('gameStatus').style.display = 'none';
        document.getElementById('boardAssembly').style.display = 'block';
        hideLoading(joinButton);
        return;
    }
    
    // Show waiting page
    document.getElementById('boardAssembly').style.display = 'none';
    document.getElementById('gameStatus').style.display = 'block';
    
    // Set searching flag
    isSearching = true;
    
    // Initialize WebSocket with board data
    initWebSocket(currentBetAmount, boardNumbers);
    
    hideLoading(joinButton);
}

function initWebSocket(amount, boardNumbers = null) {
    // Encode board numbers into a query parameter
    let boardQuery = "";
    if (boardNumbers) {
        boardQuery = `&board=${encodeURIComponent(boardNumbers.join(","))}`;
    }

    // Construct the WebSocket URL with the board parameter
    const socketUrl = `https://exaon.tech/wss/bingo/${amount}/?${boardQuery}`;

    // Create WebSocket connection
    gameSocket = new WebSocket(socketUrl);

    gameSocket.onopen = () => {
        console.log('WebSocket connection established');
        updateNetworkIndicator('Good');
        displayMessage('Connected to game server. Waiting for opponent...');
    };

    gameSocket.onmessage = (event) => {
        console.log('WebSocket message:', event.data);
        handleWebSocketMessage(event.data);
    };

    gameSocket.onerror = (error) => {
        console.error('WebSocket error:', error);
        document.getElementById('gameStatus').textContent = 'Error connecting to the game server. Please refresh the game.';
        isSearching = false;
        updateNetworkIndicator('Poor');
    };

    gameSocket.onclose = () => {
        console.log('WebSocket connection closed');
        if (isSearching) {
            displayMessage('Connection to game server lost. Please try again.');
            document.getElementById('gameStatus').style.display = 'none';
            document.getElementById('boardAssembly').style.display = 'block';
        }
        isSearching = false;
        updateNetworkIndicator('Offline');
        
        // Stop timer when connection is lost
        resetTimer();
    };
}

function handleWebSocketMessage(data) {
    try {
        const message = JSON.parse(data);
        console.log('Received message:', message);
        
        switch (message.type) {
            case 'myusername':
                // Store the username when received
                username = message.username;
                console.log('Username set:', username);
                break;
            case 'timer':
                // Handle timer message
                handleTimerMessage(message);
                break;
            case 'send.board':
                handleBoardMessage(message);
                break;
            case 'start_game':
                handleGameStartMessage(message);
                break;
            case 'turns':
                handleTurnChange(message);
                break;
            case 'result':
                handleResultMessage(message);
                break;
            case 'Game_Over':
                handleGameOver(message);
                break;
            default:
                console.log('Unknown message type:', message.type);
        }
    } catch (error) {
        console.error('Error parsing WebSocket message:', error);
        console.error('Raw message:', data);
    }
}

// Handle timer message from backend
function handleTimerMessage(message) {
    console.log('Timer message received:', message);
    
    if (message.time && message.time > 0) {
        startTimer(message.time);
    } else {
        stopTimer();
    }
}

// Handle result message from backend
function handleResultMessage(message) {
    console.log('Result message received:', message);
    
    // Add the called number to the list
    if (message.called) {
        calledNumbers.push(message.called);
        updateCalledNumbers(message.called, true);
        displayMessage(`Number called: ${message.called}`);
        
        // Reset timer when a move is made
        resetTimer();
    }
    
    // Update BINGO letters completion
    if (message.completed !== undefined) {
        updateBingoLetters(message.completed);
    }
}

function handleTurnChange(message) {
    console.log('Turn change message received:', message);
    
    // The backend sends {"type": "turns", "myturn": true/false}
    // where myturn is true if it's the player's turn
    myTurn = message.myturn;
    
    // Reset selected number
    selectedNumber = null;
    
    // Clear any previous selections
    gameBoard.forEach(cell => cell.classList.remove('selected-to-call'));
    
    // Update UI based on turn
    const callBtn = document.getElementById('callBtn');
    callBtn.disabled = true; // Disable until player selects a number
    
    // Add visual indicators for whose turn it is
    const currentPlayerCard = document.querySelector('.game-info .player-info-card:first-child');
    const opponentCard = document.querySelector('.game-info .player-info-card:last-child');
    
    // Reset styles
    currentPlayerCard.style.border = '1px solid rgba(46, 213, 115, 0.2)';
    opponentCard.style.border = '1px solid rgba(46, 213, 115, 0.2)';
    currentPlayerCard.style.boxShadow = '';
    opponentCard.style.boxShadow = '';
    
    if (myTurn) {
        // It's my turn
        displayMessage('Your turn! Select a number from your board to call.');
        
        // Highlight current player's card
        currentPlayerCard.style.border = '2px solid var(--primary)';
        currentPlayerCard.style.boxShadow = '0 0 15px rgba(46, 213, 115, 0.5)';
    } else {
        // It's opponent's turn
        displayMessage(`Waiting for ${opponent} to call a number...`);
        
        // Highlight opponent's card
        opponentCard.style.border = '2px solid var(--primary)';
        opponentCard.style.boxShadow = '0 0 15px rgba(46, 213, 115, 0.5)';
        
        // Stop timer when it's not my turn
        stopTimer();
    }
}

function handleBoardMessage(message) {
    // Hide waiting page
    document.getElementById('gameStatus').style.display = 'none';
    
    // Initialize game board with received board
    initGameBoard(message.board);
    
    if (message.start) {
        // Game is starting immediately
        document.getElementById('gameBoard').style.display = 'block';
    }
}

function handleGameStartMessage(message) {
    // Set player information
    currentPlayer = message.player_1;
    opponent = message.player_2;
    
    // Update player matching screen
    document.getElementById('player1Name').textContent = message.player_1;
    document.getElementById('player2Name').textContent = message.player_2;
    document.getElementById('player1Amount').textContent = `${message.amount} birr`;
    document.getElementById('player2Amount').textContent = `${message.amount} birr`;
    
    // Show player matching screen
    document.getElementById('gameStatus').style.display = 'none';
    document.getElementById('boardAssembly').style.display = 'none';
    document.getElementById('playerMatching').style.display = 'block';
    
    // Start countdown
    let countdown = 5;
    const countdownElement = document.getElementById('countdown');
    
    const countdownInterval = setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;
        
        if (countdown <= 0) {
            clearInterval(countdownInterval);
            
            // Hide player matching screen and show game board
            document.getElementById('playerMatching').style.display = 'none';
            document.getElementById('gameBoard').style.display = 'block';
            
            // Update player info in game board
            document.getElementById('currentPlayerName').textContent = message.player_1;
            document.getElementById('opponentName').textContent = message.player_2;
            document.getElementById('currentPlayerAmount').textContent = `${message.amount} birr`;
            document.getElementById('opponentAmount').textContent = `${message.amount} birr`;
        }
    }, 1000);
}

function handleGameOver(message) {
    console.log('Game over message received:', message);
    
    // Stop timer when game is over
    resetTimer();
    
    // Parse the winning amount to a number for display
    const winningAmount = parseInt(message.winningAmount);
    const betAmount = parseInt(message.betAmount);
    
    // Determine if the current player is the winner by comparing username
    const isWinner = username === message.winner;
    
    // Update game over popup content based on whether user is winner or loser
    document.getElementById('gameOverTitle').textContent = isWinner ? 'You Won!' : 'You Lost!';
    document.getElementById('gameOverTitle').className = isWinner ? 'game-over-title winner-title' : 'game-over-title loser-title';
    document.getElementById('gameOverSubtitle').textContent = isWinner ? 
        'Congratulations on your victory!' : 
        'Better luck next time!';
    
    document.getElementById('winnerName').textContent = message.winner;
    document.getElementById('betAmount').textContent = `${betAmount} birr`;
    document.getElementById('winningAmount').textContent = `${winningAmount} birr`;
    
    // Show confetti only for winner
    if (isWinner) {
        setTimeout(createConfetti, 500);
    }
    
    // Show the game over popup
    document.getElementById('gameOverPopup').style.display = 'flex';
    
    // Disable game buttons
    document.getElementById('callBtn').disabled = true;
    document.getElementById('bingoBtn').disabled = true;
}

function callNumber() {
    if (!myTurn) {
        displayMessage('It\'s not your turn to call a number!');
        return;
    }
    
    if (!selectedNumber) {
        displayMessage('Please select a number from your board first!');
        return;
    }
    
    // Show loading on call button
    const callBtn = document.getElementById('callBtn');
    showLoading(callBtn);
    
    // Send the selected number to the server
    if (gameSocket && gameSocket.readyState === WebSocket.OPEN) {
        gameSocket.send(JSON.stringify({
            type: 'call',
            number: selectedNumber
        }));
        
        // Disable call button until next turn
        callBtn.disabled = true;
        
        // Clear selection
        gameBoard.forEach(cell => cell.classList.remove('selected-to-call'));
        selectedNumber = null;
        
        // Reset timer when player makes a move
        resetTimer();
        
        // Hide loading after a short delay
        setTimeout(() => {
            hideLoading(callBtn);
        }, 500);
    } else {
        displayMessage('Connection lost. Please refresh the game.');
        hideLoading(callBtn);
    }
}

function claimBingo() {
    // Only allow claiming BINGO when all letters are completed
    if (completedLetters < 5) {
        displayMessage('You can\'t claim BINGO yet!');
        return;
    }
    
    // Show loading on BINGO button
    const bingoBtn = document.getElementById('bingoBtn');
    showLoading(bingoBtn);
    
    // Send BINGO claim to the server
    if (gameSocket && gameSocket.readyState === WebSocket.OPEN) {
        gameSocket.send(JSON.stringify({
            type: 'bingo',
            bingo: true
        }));
        
        // Disable BINGO button
        bingoBtn.disabled = true;
        
        // Reset timer when player claims bingo
        resetTimer();
        
        // Hide loading after a short delay
        setTimeout(() => {
            hideLoading(bingoBtn);
        }, 500);
    } else {
        displayMessage('Connection lost. Please refresh the game.');
        hideLoading(bingoBtn);
    }
}
    </script>
</body>
</html>