<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chiwe - Forgot Password</title>
<style>
:root {
    --primary: #2ed573;
    --primary-dark: #25a85c;
    --primary-light: #7bed9f;
    --primary-glow: rgba(46, 213, 115, 0.4);
    --background: #0f0f13;
    --surface: #1a1a22;
    --surface-dark: #14141a;
    --text: #ffffff;
    --text-secondary: #a0aec0;
    --danger: #ff4757;
    --warning: #ffa502;
    --success: #2ed573;
    --border-radius: 12px;
    --card-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
    --glow: 0 0 15px var(--primary-glow);
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', 'Arial', sans-serif;
    -webkit-tap-highlight-color: transparent;
}

body {
    background-color: var(--background);
    color: var(--text);
    min-height: 100vh;
    line-height: 1.6;
    overflow-x: hidden;
    background-image: 
        radial-gradient(circle at 25% 25%, rgba(46, 213, 115, 0.05) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(46, 213, 115, 0.05) 0%, transparent 50%);
    display: flex;
    align-items: center;
    justify-content: center;
}

.container {
    width: 100%;
    max-width: 450px;
    margin: 2rem;
    padding: 2rem;
}

.logo {
    text-align: center;
    margin-bottom: 2rem;
}

.logo-text {
    font-size: 2rem;
    font-weight: bold;
    color: var(--primary);
    letter-spacing: 1px;
}

.card {
    background: var(--surface);
    border-radius: var(--border-radius);
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: var(--card-shadow);
    border: 1px solid rgba(255, 255, 255, 0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card-header {
    text-align: center;
    margin-bottom: 1.5rem;
}

.card-title {
    font-size: 1.5rem;
    color: var(--text);
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.card-subtitle {
    color: var(--text-secondary);
    font-size: 0.9rem;
}

.form-group {
    margin-bottom: 1.5rem;
    position: relative;
}

.form-label {
    display: block;
    margin-bottom: 0.5rem;
    color: var(--text);
    font-weight: 500;
}

.form-input {
    width: 100%;
    padding: 0.75rem 1rem;
    background: var(--surface-dark);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius);
    color: var(--text);
    font-size: 1rem;
    transition: all 0.3s ease;
}

.form-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: var(--glow);
}

.form-input.error {
    border-color: var(--danger);
}

.error-message {
    color: var(--danger);
    font-size: 0.85rem;
    margin-top: 0.5rem;
    display: none;
}

.btn {
    width: 100%;
    padding: 0.85rem 1.5rem;
    border-radius: var(--border-radius);
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-primary {
    background: var(--primary);
    color: var(--background);
    border: none;
}

.btn-primary:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(46, 213, 115, 0.3);
}

.btn-primary:active:not(:disabled) {
    transform: translateY(1px);
}

.btn-primary:disabled {
    background: var(--text-secondary);
    cursor: not-allowed;
}

.btn-link {
    background: transparent;
    color: var(--primary);
    border: none;
    padding: 0.5rem;
    font-size: 0.9rem;
    text-decoration: underline;
}

.btn-link:hover {
    color: var(--primary-light);
}

/* OTP Input Styles */
.otp-container {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    margin-bottom: 1.5rem;
}

.otp-input {
    width: 3rem;
    height: 3rem;
    text-align: center;
    font-size: 1.25rem;
    font-weight: bold;
    background: var(--surface-dark);
    border: 2px solid rgba(255, 255, 255, 0.1);
    border-radius: var(--border-radius);
    color: var(--text);
    transition: all 0.3s ease;
}

.otp-input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: var(--glow);
}

/* Loading Spinner */
.spinner {
    width: 20px;
    height: 20px;
    border: 3px solid rgba(0, 0, 0, 0.3);
    border-radius: 50%;
    border-top-color: var(--background);
    animation: spin 1s ease-in-out infinite;
    display: none;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Success Animation */
.checkmark {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: block;
    stroke-width: 2;
    stroke: var(--background);
    stroke-miterlimit: 10;
    box-shadow: inset 0px 0px 0px var(--primary);
    animation: fill .4s ease-in-out .4s forwards, scale .3s ease-in-out .9s both;
    display: none;
}

.checkmark__circle {
    stroke-dasharray: 166;
    stroke-dashoffset: 166;
    stroke-width: 2;
    stroke-miterlimit: 10;
    stroke: var(--background);
    fill: none;
    animation: stroke 0.6s cubic-bezier(0.65, 0, 0.45, 1) forwards;
}

.checkmark__check {
    transform-origin: 50% 50%;
    stroke-dasharray: 48;
    stroke-dashoffset: 48;
    animation: stroke 0.3s cubic-bezier(0.65, 0, 0.45, 1) 0.8s forwards;
}

@keyframes stroke {
    100% {
        stroke-dashoffset: 0;
    }
}

@keyframes scale {
    0%, 100% {
        transform: none;
    }
    50% {
        transform: scale3d(1.1, 1.1, 1);
    }
}

@keyframes fill {
    100% {
        box-shadow: inset 0px 0px 0px 30px var(--primary);
    }
}

/* Alert Message */
.alert {
    padding: 1rem;
    border-radius: var(--border-radius);
    margin-bottom: 1.5rem;
    font-weight: 500;
    display: none;
}

.alert-success {
    background: rgba(46, 213, 115, 0.1);
    color: var(--primary);
    border: 1px solid rgba(46, 213, 115, 0.3);
}

.alert-error {
    background: rgba(255, 71, 87, 0.1);
    color: var(--danger);
    border: 1px solid rgba(255, 71, 87, 0.3);
}

/* Fade In Animation */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.fade-in {
    animation: fadeIn 0.5s ease forwards;
}

/* Password Strength Indicator */
.password-strength {
    margin-top: 0.5rem;
    height: 5px;
    border-radius: 5px;
    background: var(--surface-dark);
    overflow: hidden;
}

.password-strength-bar {
    height: 100%;
    width: 0;
    transition: width 0.3s ease, background-color 0.3s ease;
}

.strength-weak {
    background-color: var(--danger);
    width: 33%;
}

.strength-medium {
    background-color: var(--warning);
    width: 66%;
}

.strength-strong {
    background-color: var(--success);
    width: 100%;
}

.password-tips {
    margin-top: 0.5rem;
    font-size: 0.8rem;
    color: var(--text-secondary);
}

/* Password visibility toggle */
.password-toggle {
    position: absolute;
    right: 12px;
    top: 38px;
    color: var(--text-secondary);
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.2rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.password-toggle:hover {
    color: var(--text);
}

/* Resend OTP link */
.resend-otp {
    text-align: right;
    margin-top: 0.5rem;
}

.resend-link {
    color: var(--primary);
    font-size: 0.85rem;
    text-decoration: none;
    cursor: pointer;
}

.resend-link:hover {
    text-decoration: underline;
}

.countdown {
    color: var(--text-secondary);
    font-size: 0.85rem;
    margin-left: 0.5rem;
}

/* Debug Panel */
.debug-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: rgba(0, 0, 0, 0.8);
    color: #00ff00;
    font-family: monospace;
    font-size: 12px;
    padding: 10px;
    max-height: 150px;
    overflow-y: auto;
    z-index: 9999;
    display: none;
}

/* Responsive Design */
@media (max-width: 480px) {
    .container {
        margin: 1rem;
        padding: 1rem;
    }

    .card {
        padding: 1.5rem;
    }

    .otp-input {
        width: 2.5rem;
        height: 2.5rem;
        font-size: 1rem;
    }
}
</style>
  <link
    rel="icon"
    href="https://i.postimg.cc/FzgPtp2v/photo-2025-05-31-05-36-51.jpg"
    type="image/jpeg"
  />

  <!-- 2) For older browsers, you can also include “shortcut icon” -->
  <link
    rel="shortcut icon"
    href="https://i.postimg.cc/FzgPtp2v/photo-2025-05-31-05-36-51.jpg"
    type="image/jpeg"
  />
</head>
<body>
<div class="container">
    <div class="logo">
        <div class="logo-text">Chiwe</div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">Forgot Password</h1>
            <p class="card-subtitle">Enter your email to recover your account</p>
        </div>
        
        <div id="alertMessage" class="alert"></div>
        
        <!-- Email Form -->
        <div id="emailForm">
            <div class="form-group">
                <label for="email" class="form-label">Email Address</label>
                <input type="email" id="email" class="form-input" placeholder="Enter your email">
                <div id="emailError" class="error-message">Please enter a valid email address</div>
            </div>
            
            <button id="recoverBtn" class="btn btn-primary">
                <span>Recover Account</span>
                <div id="recoverSpinner" class="spinner"></div>
                <svg id="recoverCheck" class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </button>
        </div>
        
        <!-- OTP and New Password Form -->
        <div id="resetForm" style="display: none;">
            <div class="form-group">
                <label class="form-label">Enter OTP Code</label>
                <div class="otp-container">
                    <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                    <input type="text" class="otp-input" maxlength="1" pattern="[0-9]" inputmode="numeric">
                </div>
                <div id="otpError" class="error-message">Please enter a valid 6-digit OTP</div>
                <div class="resend-otp">
                    <span id="resendOtp" class="resend-link">Resend OTP</span>
                    <span id="otpCountdown" class="countdown"></span>
                </div>
            </div>
            
            <div class="form-group">
                <label for="newPassword" class="form-label">New Password</label>
                <input type="password" id="newPassword" class="form-input" placeholder="Enter new password">
                <button type="button" class="password-toggle" id="toggleNewPassword">👁️</button>
                <div class="password-strength">
                    <div id="passwordStrengthBar" class="password-strength-bar"></div>
                </div>
                <div class="password-tips">Password must be at least 6 characters long</div>
                <div id="passwordError" class="error-message">Password must be at least 6 characters long</div>
            </div>
            
            <div class="form-group">
                <label for="confirmPassword" class="form-label">Confirm Password</label>
                <input type="password" id="confirmPassword" class="form-input" placeholder="Confirm new password">
                <button type="button" class="password-toggle" id="toggleConfirmPassword">👁️</button>
                <div id="confirmError" class="error-message">Passwords do not match</div>
            </div>
            
            <button id="changePasswordBtn" class="btn btn-primary">
                <span>Change Password</span>
                <div id="changeSpinner" class="spinner"></div>
                <svg id="changeCheck" class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/>
                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/>
                </svg>
            </button>
        </div>
    </div>
    
    <div style="text-align: center;">
        <button id="backToLogin" class="btn btn-link">Back to Login</button>
    </div>
</div>

<!-- Debug Panel (hidden in production) -->
<div id="debugPanel" class="debug-panel"></div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // DOM Elements
        const emailForm = document.getElementById('emailForm');
        const resetForm = document.getElementById('resetForm');
        const emailInput = document.getElementById('email');
        const emailError = document.getElementById('emailError');
        const recoverBtn = document.getElementById('recoverBtn');
        const recoverSpinner = document.getElementById('recoverSpinner');
        const recoverCheck = document.getElementById('recoverCheck');
        const otpInputs = document.querySelectorAll('.otp-input');
        const otpError = document.getElementById('otpError');
        const newPassword = document.getElementById('newPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        const passwordError = document.getElementById('passwordError');
        const confirmError = document.getElementById('confirmError');
        const changePasswordBtn = document.getElementById('changePasswordBtn');
        const changeSpinner = document.getElementById('changeSpinner');
        const changeCheck = document.getElementById('changeCheck');
        const alertMessage = document.getElementById('alertMessage');
        const passwordStrengthBar = document.getElementById('passwordStrengthBar');
        const backToLogin = document.getElementById('backToLogin');
        const toggleNewPassword = document.getElementById('toggleNewPassword');
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const resendOtp = document.getElementById('resendOtp');
        const otpCountdown = document.getElementById('otpCountdown');
        const debugPanel = document.getElementById('debugPanel');
        
        // Debug function - Enable for development, disable for production
        const DEBUG_MODE = false;
        
        function debug(message, data = null) {
            if (!DEBUG_MODE) return;
            
            debugPanel.style.display = 'block';
            const timestamp = new Date().toISOString().split('T')[1].split('.')[0];
            let logMessage = `[${timestamp}] ${message}`;
            
            if (data) {
                if (typeof data === 'object') {
                    logMessage += `: ${JSON.stringify(data)}`;
                } else {
                    logMessage += `: ${data}`;
                }
            }
            
            const logEntry = document.createElement('div');
            logEntry.textContent = logMessage;
            debugPanel.appendChild(logEntry);
            debugPanel.scrollTop = debugPanel.scrollHeight;
        }
        
        // Email validation
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Password strength check
        function checkPasswordStrength(password) {
            if (!password) {
                passwordStrengthBar.className = 'password-strength-bar';
                passwordStrengthBar.style.width = '0';
                return;
            }
            
            if (password.length < 6) {
                passwordStrengthBar.className = 'password-strength-bar strength-weak';
                return 'weak';
            } else if (password.length < 10 || !/[A-Z]/.test(password) || !/[0-9]/.test(password)) {
                passwordStrengthBar.className = 'password-strength-bar strength-medium';
                return 'medium';
            } else {
                passwordStrengthBar.className = 'password-strength-bar strength-strong';
                return 'strong';
            }
        }
        
        // Show alert message
        function showAlert(message, type) {
            alertMessage.textContent = message;
            alertMessage.className = `alert alert-${type} fade-in`;
            alertMessage.style.display = 'block';
            
            debug(`Alert shown: ${message} (${type})`);
            
            // Auto hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    alertMessage.style.display = 'none';
                }, 5000);
            }
        }
        
        // Toggle password visibility
        toggleNewPassword.addEventListener('click', function() {
            if (newPassword.type === 'password') {
                newPassword.type = 'text';
                this.textContent = '🔒';
            } else {
                newPassword.type = 'password';
                this.textContent = '👁️';
            }
        });
        
        toggleConfirmPassword.addEventListener('click', function() {
            if (confirmPassword.type === 'password') {
                confirmPassword.type = 'text';
                this.textContent = '🔒';
            } else {
                confirmPassword.type = 'password';
                this.textContent = '👁️';
            }
        });
        
        // OTP resend countdown
        let countdownTimer;
        function startOtpCountdown(seconds) {
            let remainingTime = seconds;
            resendOtp.style.pointerEvents = 'none';
            resendOtp.style.opacity = '0.5';
            
            countdownTimer = setInterval(() => {
                otpCountdown.textContent = `(${remainingTime}s)`;
                remainingTime--;
                
                if (remainingTime < 0) {
                    clearInterval(countdownTimer);
                    otpCountdown.textContent = '';
                    resendOtp.style.pointerEvents = 'auto';
                    resendOtp.style.opacity = '1';
                }
            }, 1000);
        }
        
        // Resend OTP
        resendOtp.addEventListener('click', function() {
            // Get email from the first form
            const email = emailInput.value.trim();
            
            // Create form data
            const formData = new FormData();
            formData.append('email', email);
            formData.append('resend', 'true');
            
            debug('Resending OTP', { email });
            
            // Show loading state in the alert
            showAlert('Sending new OTP code...', 'success');
            
            // Send AJAX request
            fetch('resend-otp-fp/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            })
            .then(response => {
                debug('Resend OTP response status', response.status);
                return response.json();
            })
            .then(data => {
                debug('Resend OTP response data', data);
                
                if (data.Success) {
                    showAlert(data.message, 'success');
                    startOtpCountdown(60); // Start 60 second countdown
                } else {
                    showAlert(data.message || 'Failed to resend OTP. Please try again.', 'error');
                }
            })
            .catch(error => {
                debug('Resend OTP error', error.message);
                showAlert('Network error. Please try again.', 'error');
            });
        });
        
        // Handle email form submission
        recoverBtn.addEventListener('click', function() {
            const email = emailInput.value.trim();
            
            // Validate email
            if (!isValidEmail(email)) {
                emailInput.classList.add('error');
                emailError.style.display = 'block';
                debug('Email validation failed', { email });
                return;
            }
            
            // Reset validation state
            emailInput.classList.remove('error');
            emailError.style.display = 'none';
            
            // Show loading state
            recoverBtn.disabled = true;
            recoverSpinner.style.display = 'block';
            
            debug('Sending recovery request', { email });
            
            // Create form data for Django
            const formData = new FormData();
            formData.append('email', email);
            
            
            fetch('', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            })
            .then(response => {
                debug('Recovery response status', response.status);
                return response.json();
            })
            .then(data => {
                debug('Recovery response data', data);
                
                if (data.Success) {
                    // Show success checkmark
                    recoverSpinner.style.display = 'none';
                    recoverCheck.style.display = 'block';
                    
                    // Show success message
                    showAlert(data.message, 'success');
                    
                    // Switch to OTP form after a delay
                    setTimeout(() => {
                        emailForm.style.display = 'none';
                        resetForm.style.display = 'block';
                        resetForm.classList.add('fade-in');
                        otpInputs[0].focus();
                        
                        // Start OTP countdown
                        startOtpCountdown(60);
                    }, 1500);
                } else {
                    // Show error message
                    recoverSpinner.style.display = 'none';
                    recoverBtn.disabled = false;
                    showAlert(data.message || 'An error occurred. Please try again.', 'error');
                }
            })
            .catch(error => {
                debug('Recovery error', error.message);
                recoverSpinner.style.display = 'none';
                recoverBtn.disabled = false;
                showAlert('Network error. Please try again.', 'error');
            });
        });
        
        // OTP input handling
        otpInputs.forEach((input, index) => {
            // Auto-focus next input
            input.addEventListener('input', function() {
                if (this.value.length === 1) {
                    if (index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    } else {
                        // If last OTP input, focus on password field
                        newPassword.focus();
                    }
                }
            });
            
            // Handle backspace
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && !this.value && index > 0) {
                    otpInputs[index - 1].focus();
                }
            });
            
            // Only allow numbers
            input.addEventListener('input', function() {
                this.value = this.value.replace(/[^0-9]/g, '');
            });
            
            // Handle Enter key
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    if (index < otpInputs.length - 1) {
                        otpInputs[index + 1].focus();
                    } else {
                        newPassword.focus();
                    }
                }
            });
        });
        
        // Password strength check
        newPassword.addEventListener('input', function() {
            checkPasswordStrength(this.value);
        });
        
        // Real-time password match validation
        confirmPassword.addEventListener('input', function() {
            if (this.value && this.value !== newPassword.value) {
                confirmPassword.classList.add('error');
                confirmError.style.display = 'block';
            } else {
                confirmPassword.classList.remove('error');
                confirmError.style.display = 'none';
            }
        });
        
        // Handle Enter key in password fields
        newPassword.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                confirmPassword.focus();
            }
        });
        
        confirmPassword.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                changePasswordBtn.click();
            }
        });
        
        // Handle password reset form submission
        changePasswordBtn.addEventListener('click', function() {
            // Get OTP value
            let otp = '';
            let isOtpValid = true;
            
            otpInputs.forEach(input => {
                if (!input.value) {
                    isOtpValid = false;
                }
                otp += input.value;
            });
            
            // Validate OTP
            if (!isOtpValid || otp.length !== 6) {
                otpError.style.display = 'block';
                debug('OTP validation failed', { otp });
                return;
            } else {
                otpError.style.display = 'none';
            }
            
            // Validate password
            const newPass = newPassword.value;
            const confirmPass = confirmPassword.value;
            
            let isValid = true;
            
            if (newPass.length < 6) {
                newPassword.classList.add('error');
                passwordError.style.display = 'block';
                isValid = false;
                debug('Password validation failed: too short');
            } else {
                newPassword.classList.remove('error');
                passwordError.style.display = 'none';
            }
            
            if (newPass !== confirmPass) {
                confirmPassword.classList.add('error');
                confirmError.style.display = 'block';
                isValid = false;
                debug('Password validation failed: passwords do not match');
            } else {
                confirmPassword.classList.remove('error');
                confirmError.style.display = 'none';
            }
            
            if (!isValid) return;
            
            // Show loading state
            changePasswordBtn.disabled = true;
            changeSpinner.style.display = 'block';
            
            debug('Sending password reset request', { 
                email: emailInput.value.trim(),
                otp: otp,
                newPassword: '********', // Don't log actual password
                confirmPassword: '********' // Don't log actual password
            });
            
            // Create form data for Django
            const formData = new FormData();
            formData.append('email', emailInput.value.trim());
            formData.append('otp', otp);
            formData.append('new_password', newPass);
            formData.append('confirm_password', confirmPass); // Added confirm_password field
            
            // Log form data entries for debugging (excluding sensitive data)
            if (DEBUG_MODE) {
                debug('Form data entries:');
                for (let pair of formData.entries()) {
                    if (pair[0] === 'new_password' || pair[0] === 'confirm_password') {
                        debug(`- ${pair[0]}: ********`);
                    } else {
                        debug(`- ${pair[0]}: ${pair[1]}`);
                    }
                }
            }
            
            // Send AJAX request - Using FormData for Django compatibility
            fetch('validate_recovery/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken')
                },
                body: formData
            })
            .then(response => {
                debug('Password reset response status', response.status);
                return response.json();
            })
            .then(data => {
                debug('Password reset response data', data);
                
                if (data.Success) {
                    // Show success checkmark
                    changeSpinner.style.display = 'none';
                    changeCheck.style.display = 'block';
                    
                    // Show success message
                    showAlert(data.message, 'success');
                    
                    // Redirect to login page after delay
                    setTimeout(() => {
                        window.location.href = '/login';
                    }, 2000);
                } else {
                    // Show error message
                    changeSpinner.style.display = 'none';
                    changePasswordBtn.disabled = false;
                    showAlert(data.message || 'An error occurred. Please try again.', 'error');
                }
            })
            .catch(error => {
                debug('Password reset error', error.message);
                changeSpinner.style.display = 'none';
                changePasswordBtn.disabled = false;
                showAlert('Network error. Please try again.', 'error');
            });
        });
        
        // Back to login button
        backToLogin.addEventListener('click', function() {
            window.location.href = '/login';
        });
        
        // Helper function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // Initialize debug panel if in debug mode
        if (DEBUG_MODE) {
            debug('Debug mode enabled');
            debug('Page loaded successfully');
        }
    });
</script>
</body>
</html>